<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>blog.wamser.eu - GHC and ARM</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">blog.wamser.eu</a>
            </div>
            <div id="navigation">
                <a href="../about.html">About</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>GHC and ARM</h1>

            <div class="info">
    Posted on January 21, 2016
    
</div>

<p>Yes, I have to start my first proper blog post with a confession:</p>
<blockquote>
<p><em>I like to use IT to inflict pain on myself.</em></p>
</blockquote>
<p>Or maybe I just like to fiddle around with things.</p>
<p>Long story short: I have a HP Chromebook 11 running <a href="https://archlinuxarm.org/">Arch Linux ARM (ALARM)</a> and I wanted to start blogging with <a href="https://jaspervdj.be/hakyll/">Hakyll</a>. The first steps were quite smooth, as GHC was provided by ALARM and I just had to downgrade LLVM to an older version. Things started to get complicated, when I had to reinstall everything from scratch after I had carelessly updated systemd.</p>
<p>At the time I did the reinstall, GHC had been dropped from ALARM, because it didn’t build with recent LLVM versions (on ARM). Reading through a few posts and reddits I got the impression that it is sort of a running gag by the LLVM people to make sure current and upcoming versions of GHC won’t build current LLVM releases (again: only on ARM).<br />
That was frustrating, but luckily not only for me: Tom Hall provided <a href="https://github.com/Thra11/PKGBUILDS">PKGBUILDs for a recent GHC and matching LLVM</a> (see also his <a href="https://thra11.github.io/posts/2015-09-07-GHC-On-Arch-Linux-Arm.html">blog post</a>). Thankfully he also provided binary packages for ARM7h, because compiling bigger stuff on my Chromebook, well, just say it takes some time.</p>
<p>Based upon this I was then able to <a href="2016-02-02-hakyll-blog-setup.markdown">build Hakyll and set up my blog</a>.</p>
<p>The other downside of having GHC removed from the repos was that also other useful packages, such as <code>pandoc</code> disappeared. So I <a href="https://github.com/wamserma/PKGBUILDs/tree/master/pandoc">modified the ARCH upstream-PKGBUILD</a> to remove all build dependencies aside from the above mentioned GHC-setup. Building this on my Chromebook took hours and runs Out-Of-Memory unless I add a 1GB zram disk and create a swap on it.</p>
<p>As I am writing this post, ALARM reincluded GHC (yay!). Unfortunately they made in dependent on <a href="https://www.archlinux.org/packages/?name=llvm35">llvm35</a>, which clashes with <a href="https://www.archlinux.org/packages/?name=llvm">llvm</a>, so <code>pacman -Syu</code> will not work if you have Tom Hall’s packages and <code>llvm</code> installed, because the update to <code>ghc</code> pulls in <code>llvm35</code> as a dependcy. For the time being I suggest ignoring the update to <code>ghc</code>. Updating <code>pandoc</code> is not affected by this.</p>
<p>As for a fix: My <a href="https://github.com/archlinuxarm/PKGBUILDs/pull/1327">whimpy attempt</a> at getting Tom Hall’s encapsulated LLVM in was denied. (Rightfully so. I just wanted to bring more attention to this issue.) I guess the proper way would be to get <code>ghc-llvm</code> into (https://github.com/archlinuxarm/PKGBUILDs/tree/master/alarm) and reflect this in the PKGBUILD for <code>ghc</code>, both with a proper pull request and after thorough testing.</p>
<p>Or just hope for LLVM 3.8 and GHC 8 to play nicely together.</p>

        </div>
        <div id="footer">
            <a href="../impressum.html">Impressum</a>
        </div>
    </body>
</html>
